---
import "../styles/global.css";
import Header from "../components/header.astro";
import Footer from "../components/footer.astro";
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Length converter</title>
	</head>
	<body class="flex flex-col h-screen justify-between">
		<Header></Header>
		<main class="flex flex-col items-center justify-evenly">
			<div class="text-center mb-10">
				<h1 class="text-5xl font-bold text-gray-800 my-5">Length converter</h1>
			</div>
			<div class="flex gap-6 bg-gray-100 p-6 rounded-lg shadow-md">
				<form action="" method="POST" class="flex flex-col items-center w-xl">
					<label for="lengthInput" class="block text-gray-500 font-semibold mb-2 w-full">Value</label>
					<input type="number" id="lengthInput" name="lengthInput" class="w-full p-2 border border-gray-300 rounded mb-4" placeholder="Enter value" value=lengthInput />

					<div class="flex gap-4 mb-4 w-full">
						<div class="w-1/2">
							<label for="fromUnit" class="block text-gray-500 font-semibold mb-2">From</label>
							<select id="fromUnit" name="fromUnit" class="w-full p-2 border border-gray-300 rounded text-gray-500">
								<option value="meters">Meters</option>
								<option value="centimeters">Centimeters</option>
								<option value="milimeters">Milimeters</option>
								<option value="kilometers">Kilometers</option>
								<option value="feet">Feet</option>
								<option value="inches">Inches</option>
								<option value="miles">Miles</option>
								<option value="yards">Yards</option>
							</select>
						</div>

						<div class="w-1/2">
							<label for="toUnit" class="block text-gray-500 font-semibold mb-2">To</label>
							<select id="toUnit" name="toUnit" class="w-full p-2 border border-gray-300 rounded mb-4 text-gray-500">
								<option value="meters">Meters</option>
								<option value="centimeters">Centimeters</option>
								<option value="milimeters">Milimeters</option>
								<option value="kilometers">Kilometers</option>
								<option value="feet">Feet</option>
								<option value="inches">Inches</option>
								<option value="miles">Miles</option>
								<option value="yards">Yards</option>
							</select>
						</div>
					</div>

					<button type="submit" class="bg-blue-100 hover:bg-blue-200 py-2 px-4 rounded-4xl" >
						<img src="https://www.svgrepo.com/show/507867/switch-horizontal.svg" alt="" width="60px">
					</button>

					<label for="result" class="block text-gray-700 font-semibold mb-2 w-full mt-3">Result</label>
					<input type="number" id="result" name="result" class="w-full p-2 border border-gray-300 rounded mb-4 text-gray-700 font-semibold" value="5" disabled/>
				</form>
				
			</div>
		</main>
		
		<Footer></Footer>
	</body>
	<script>
  const form = document.querySelector<HTMLFormElement>('form');
  if (!form) {
    // Form not found in the DOM — stop early to satisfy TypeScript and avoid runtime errors
    throw new Error('Form element not found');
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();

    const lengthInputEl = document.getElementById('lengthInput') as HTMLInputElement | null;
    const fromUnitEl = document.getElementById('fromUnit') as HTMLSelectElement | null;
    const toUnitEl = document.getElementById('toUnit') as HTMLSelectElement | null;
    const resultEl = document.getElementById('result') as HTMLInputElement | null;

    if (!lengthInputEl || !fromUnitEl || !toUnitEl || !resultEl) {
      // Missing expected inputs — fail gracefully
      return;
    }

    const lengthInput = parseFloat(lengthInputEl.value);
    if (Number.isNaN(lengthInput)) {
      resultEl.value = 'Invalid';
      return;
    }

    const fromUnit = fromUnitEl.value;
    const toUnit = toUnitEl.value;

    const conversionRates: Record<string, number> = {
      meters: 1,
      centimeters: 0.01,
      milimeters: 0.001, // consider correcting to "millimeters" if desired
      kilometers: 1000,
      feet: 0.3048,
      inches: 0.0254,
      miles: 1609.34,
      yards: 0.9144,
    };

    if (!(fromUnit in conversionRates) || !(toUnit in conversionRates)) {
      resultEl.value = 'Invalid unit';
      return;
    }

    const valueInMeters = lengthInput * conversionRates[fromUnit];
    const convertedValue = valueInMeters / conversionRates[toUnit];

    resultEl.value = Number.isFinite(convertedValue) ? convertedValue.toFixed(4) : 'Invalid';
  });
</script>
</html>